Util.htmlDecode=function(t){var e=document.createElement("div");return e.innerHTML=decodeURIComponent(t),e.innerText};var Admin=function(){this.register={},this.tools=["#page-list","#theme-list","#link-list","#preference","#user-list","#plugin-list","#others","#category-list"],this.adTools=["link-list","preference","theme-list","page-list","user-list","plugin-list","others","category-list"]};$.extend(Admin.prototype,{logout:function(){window.location.href=Label.servePath+"/logout"},toggleMenu:function(){"-240px"===$("#tabs").css("left")?($("#tabs").css("left",0),$(".tabs__bg").show()):($("#tabs").css("left","-240px"),$(".tabs__bg").hide())},clearTip:function(){$("#tipMsg").text(""),$("#loadMsg").text("")},setHashByPage:function(t){var e=window.location.hash.split("/");/^\d*$/.test(e[e.length-1])?e[e.length-1]=t:e.push(t),window.location.hash=e.join("/")},selectTab:function(t){window.location.hash="#"+t},analyseHash:function(){for(var t=window.location.hash,e=t.substr(1,t.length-1).split("/"),i={page:1,hashList:[]},a=0;a<e.length;a++)a===e.length-1&&/^\d+$/.test(e[a])?i.page=e[a]:i.hashList.push(e[a]);return i},setCurByHash:function(){$(window).scrollTop(0),$("#tipMsg").text("");var t=admin.analyseHash(),e=t.hashList[1],i=t.hashList[2];if(1===t.hashList.length&&(e=t.hashList[0]),""!==e){try{if(admin.editors.articleEditor.getContent){if("article"!==e&&admin.article.isConfirm&&""!==admin.editors.articleEditor.getContent().replace(/\s/g,"")&&admin.article.content!==admin.editors.articleEditor.getContent()&&!confirm(Label.editorLeaveLabel))return void(window.location.hash="#article/article");if("article"===e&&admin.article.isConfirm&&""!==admin.editors.articleEditor.getContent().replace(/\s/g,"")&&admin.article.content!==admin.editors.articleEditor.getContent())return}}catch(t){console.log(t)}"article"!==e&&admin.editors.articleEditor.setContent&&admin.article.clear(),admin.article.isConfirm=!0,$("#tabs").tabs("setCurrent",e),$("#loadMsg").text(Label.loadingLabel),1===$("#tabsPanel_"+e).length?""===$("#tabsPanel_"+e).html().replace(/\s/g,"")?$("#tabsPanel_"+e).load("admin-"+e+".do",function(){"article"===e&&admin.article.status.id?admin.register[e].init.call(admin.register[e].obj,admin.article.getAndSet):admin.register[e].init.call(admin.register[e].obj,t.page),i&&$("#tab"+e.substring(0,1).toUpperCase()+e.substring(1)).tabs("setCurrent",i),admin.plugin.setCurByHash(t)}):("article"===e&&admin.article.status.id&&admin.article.getAndSet(),admin.register[e]&&admin.register[e].refresh&&admin.register[e].refresh.call(admin.register[e].obj,t.page),i&&$("#tab"+e.substring(0,1).toUpperCase()+e.substring(1)).tabs("setCurrent",i),admin.plugin.setCurByHash(t)):($("#tipMsg").text("Error: No tab! "+Label.reportIssueLabel),$("#loadMsg").text(""))}},init:function(){Util.killIE(),$("#loadMsg").text(Label.loadingLabel),$("#tabs").tabs(),setInterval(function(){""!==$("#tipMsg").text()&&setTimeout(function(){$("#tipMsg").text("")},7e3)},6e3),$("#loadMsg").text(""),window.onbeforeunload=function(t){if("#article/article"===window.location.hash)return t&&(t.returnValue=Label.editorLeaveLabel),Label.editorLeaveLabel},$(document).ajaxError(function(t,e,i,a){200!==e.status&&$("#tipMsg").text(e.status+": "+a)})},collapseNav:function(t){$(t).next().slideToggle("normal",function(){"none"!==this.style.display?($(t).find(".icon-chevron-down")[0].className="icon-chevron-up fn__right",$(t).addClass("tab-current")):($(t).find(".icon-chevron-up")[0].className="icon-chevron-down fn__right",$(t).removeClass("tab-current")),$("#tabs > ul").height("auto"),$("#tabs > ul").height($("#tabs > ul").height()+80)})},inited:function(){if("adminRole"!==Label.userRole)for(var t=0;t<this.adTools.length;t++)$("#tabs").tabs("remove",this.adTools[t]);else for(var e=0;e<this.tools.length;e++)if("#"+window.location.hash.split("/")[1]===this.tools[e]){$("#tabToolsTitle").click();break}this.setCurByHash()}});var admin=new Admin;
admin.editors={};var SoloEditor=function(e){this.conf=e,this.init()};$.extend(SoloEditor.prototype,{init:function(){this.editor=new Vditor(this.conf.id,{cache:!0,tab:"\t",preview:{delay:500,mode:this.conf.previewMode,url:Label.servePath+"/console/markdown/2html",hljs:{enable:!Label.luteAvailable,style:Label.hljsStyle},parse:function(e){"none"!==e.style.display&&Util.parseLanguage()}},upload:{max:10485760,url:Label.uploadURL,token:Label.uploadToken,filename:function(e){return e.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g,"").replace(/[\?\\/:|<>\*\[\]\(\)\$%\{\}@~]/g,"").replace("/\\s/g","")}},height:this.conf.height,counter:102400,resize:{enable:this.conf.resize},lang:Label.localeString}),"function"==typeof this.conf.fun&&this.conf.fun()},getContent:function(){return this.editor.getValue()},setContent:function(e){this.editor.setValue(e)},remove:function(){document.getElementById(this.editor.vditor.id).outerHTML=""}}),admin.editors.articleEditor={},admin.editors.abstractEditor={};
var TablePaginate=function(a){this.id=a,this.currentPage=1};$.extend(TablePaginate.prototype,{buildTable:function(a,t){var e={colModel:a,noDataTip:Label.noDataLabel};t||(e.expendRow={index:"expendRow"}),$("#"+this.id+"Table").table(e)},initPagination:function(){var a=this.id;$("#"+a+"Pagination").paginate({bind:function(a,t){t?$("#tipMsg").text(t):admin.setHashByPage(a)},currentPage:1,errorMessage:Label.inputErrorLabel,nextPageText:">",previousPageText:"<",goText:Label.gotoLabel,type:"custom",custom:[1],pageCount:1})},initCommentsDialog:function(){var a=this;$("#"+this.id+"Comments").dialog({modal:!0,hideFooter:!0,close:function(){return admin[a.id+"List"].getList(a.currentPage),!0}})},updateTablePagination:function(a,t,e){if((t=parseInt(t))>e.paginationPageCount&&1<t)return $("#tipMsg").text(Label.pageLabel+t+Label.notFoundLabel),void $("#loadMsg").text("");$("#"+this.id+"Table").table("update",{data:[{groupName:"all",groupData:a}]}),0===e.paginationPageCount&&(e.paginationPageCount=1),$("#"+this.id+"Pagination").paginate("update",{pageCount:e.paginationPageCount,currentPage:t,custom:e.paginationPageNums}),this.currentPage=t}});
admin.article={isConfirm:!0,status:{id:void 0,isArticle:void 0},content:"",get:function(t,e){this.status.id=t,this.status.isArticle=e,admin.selectTab("article/article")},getAndSet:function(){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/article/"+admin.article.status.id,type:"GET",cache:!1,success:function(e,t){if($("#tipMsg").text(e.msg),e.sc){$("#title").val(e.article.articleTitle),admin.editors.articleEditor.setContent(e.article.articleContent),admin.editors.abstractEditor.setContent(e.article.articleAbstract),admin.article.content=admin.editors.articleEditor.getContent();for(var i=e.article.articleTags,a="",l=0;l<i.length;l++)0===l?a=i[l].tagTitle:a+=","+i[l].tagTitle;$("#tag").val(a),$("#permalink").val(e.article.articlePermalink),$("#viewPwd").val(e.article.articleViewPwd),$("#articleCommentable").prop("checked",e.article.articleCommentable);var s=e.article.signs;$(".signs button").each(function(t){parseInt(e.article.articleSignId)===parseInt(s[t].oId)?$("#articleSign"+s[t].oId).addClass("selected"):$("#articleSign"+s[t].oId).removeClass("selected")}),admin.article.setStatus(),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},del:function(t,i,e){confirm(Label.confirmRemoveLabel+Label.articleLabel+'"'+Util.htmlDecode(e)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/article/"+t,type:"DELETE",cache:!1,success:function(t,e){$("#tipMsg").text(t.msg),t.sc?admin[i+"List"].getList(1):$("#loadMsg").text("")}}))},add:function(e){if(admin.article.validate()){var i=this;i._addDisabled(),$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var t="";$(".signs button").each(function(){"selected"===this.className&&(t=this.id.substr(this.id.length-1,1))});var a=admin.editors.articleEditor.getContent(),l=admin.editors.abstractEditor.getContent();if($("#articleThumbnail").prop("checked")){var s=$(".thumbnail__img").css("background-image");a="![]("+s.substring(5,s.length-2).replace("w/768","w/960").replace("h/432","h/540")+")\n\n"+a}var c={article:{articleTitle:$("#title").val(),articleContent:a,articleAbstract:l,articleTags:this.trimUniqueArray($("#tag").val()).toString(),articlePermalink:$("#permalink").val(),articleStatus:e,articleSignId:t,postToCommunity:$("#postToCommunity").prop("checked"),articleCommentable:$("#articleCommentable").prop("checked"),articleViewPwd:$("#viewPwd").val()}};$.ajax({url:Label.servePath+"/console/article/",type:"POST",cache:!1,data:JSON.stringify(c),success:function(t){$("#tipMsg").text(t.msg),t.sc&&(admin.article.status.id=void 0,0===e?admin.selectTab("article/article-list"):admin.selectTab("article/draft-list"),admin.article.isConfirm=!1)},complete:function(t,e){i._removeDisabled(),$("#loadMsg").text("")}})}},update:function(i){if(admin.article.validate()){var a=this;a._addDisabled(),$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var t="";$(".signs button").each(function(){"selected"===this.className&&(t=this.id.substr(this.id.length-1,1))});var e=admin.editors.articleEditor.getContent(),l=admin.editors.abstractEditor.getContent();if($("#articleThumbnail").prop("checked")){var s=$(".thumbnail__img").css("background-image");e="![]("+s.substring(5,s.length-2).replace("w/768","w/960").replace("h/432","h/540")+") \n\n"+e}var c={article:{oId:this.status.id,articleTitle:$("#title").val(),articleContent:e,articleAbstract:l,articleTags:this.trimUniqueArray($("#tag").val()).toString(),articlePermalink:$("#permalink").val(),articleStatus:i,articleSignId:t,articleCommentable:$("#articleCommentable").prop("checked"),articleViewPwd:$("#viewPwd").val(),postToCommunity:$("#postToCommunity").prop("checked")}};$.ajax({url:Label.servePath+"/console/article/",type:"PUT",cache:!1,data:JSON.stringify(c),success:function(t,e){$("#tipMsg").text(t.msg),t.sc&&(0===i?admin.selectTab("article/article-list"):admin.selectTab("article/draft-list"),$("#tipMsg").text(Label.updateSuccLabel),admin.article.status.id=void 0,admin.article.isConfirm=!1)},complete:function(t,e){a._removeDisabled(),$("#loadMsg").text("")}})}},setStatus:function(){$.ajax({url:Label.servePath+"/console/tags",type:"GET",cache:!1,success:function(t,e){if($("#tipMsg").text(t.msg),t.sc){if(!(t.tags.length<=0)){$("#tagCheckboxPanel>span").remove("");for(var i="",a=0;a<t.tags.length;a++)i+="<span>"+t.tags[a].tagTitle+"</span>";$("#tagCheckboxPanel").html(i+'<div class="fn__clear"></div>'),$("#loadMsg").text("")}}else $("#loadMsg").text("")}}),this.status?this.status.isArticle?($("#unSubmitArticle").show(),$("#saveArticle").hide(),$("#submitArticle").show()):($("#submitArticle").show(),$("#unSubmitArticle").hide(),$("#saveArticle").show()):($("#submitArticle").show(),$("#unSubmitArticle").hide(),$("#saveArticle").show(),$("#postToCommunityPanel").show())},clear:function(){this.status={id:void 0,isArticle:void 0},this.setStatus(),$("#title").val(""),admin.editors.articleEditor.setContent(""),admin.editors.abstractEditor.setContent(""),$("#tag").val(""),$("#tagCheckboxPanel").hide().find("span").removeClass("selected"),$("#permalink").val(""),$("#articleCammentable").prop("checked",!0),$("#postToCommunity").prop("checked",!1),$(".signs button").each(function(t){this.className=0===t?"selected":""}),$("#articleThumbnail").prop("checked")&&$("#articleThumbnail").click()},init:function(t){$(".signs button").click(function(t){$(".signs button").removeClass("selected"),$(this).addClass("selected")}),$("#tipMsg").text(Label.uploadMsg),$.ajax({url:Label.servePath+"/console/tags",type:"GET",cache:!1,success:function(t,e){if($("#tipMsg").text(t.msg),t.sc){if(!(t.tags.length<=0)){for(var i=[],a=0;a<t.tags.length;a++)i.push(t.tags[a].tagTitle);$("#tag").completed({height:160,buttonText:Label.selectLabel,data:i}),$("#loadMsg").text("")}}else $("#loadMsg").text("")}}),$("#submitArticle").click(function(){admin.article.status.id?admin.article.update(0):admin.article.add(0)}),$("#saveArticle").click(function(){admin.article.status.id?admin.article.update(admin.article.status.isArticle?0:1):admin.article.add(1)}),admin.editors.articleEditor=new SoloEditor({id:"articleContent",height:500,fun:t,previewMode:"both",resize:!1}),admin.editors.abstractEditor=new SoloEditor({id:"abstract",height:200,previewMode:"editor",resize:!0}),$("#articleThumbnailBtn").click(function(){$.ajax({url:Label.servePath+"/console/thumbs?n=1&w=768&h=432",type:"GET",cache:!1,success:function(t,e){t.sc?$("#articleThumbnailBtn").prev().css("background-image","url("+t.data[0]+")"):$("#loadMsg").text(t.msg)}})}).click()},validate:function(){var t=admin.editors.articleEditor.getContent();if(""===$("#title").val().replace(/\s/g,""))$("#tipMsg").text(Label.titleEmptyLabel),$("#title").focus().val("");else{if(""!==t.replace(/\s/g,""))return!0;$("#tipMsg").text(Label.contentEmptyLabel)}return!1},unPublish:function(){var i=this;i._addDisabled(),$.ajax({url:Label.servePath+"/console/article/unpublish/"+admin.article.status.id,type:"PUT",cache:!1,success:function(t,e){$("#tipMsg").text(t.msg),t.sc&&(admin.selectTab("article/draft-list"),admin.article.status.id=void 0,admin.article.isConfirm=!1)},complete:function(t,e){i._removeDisabled(),$("#loadMsg").text("")}})},trimUniqueArray:function(t){for(var e=(t=t.toString()).split(","),i=0;i<e.length;i++)e[i]=e[i].replace(/(^\s*)|(\s*$)/g,""),""===e[i]&&(e.splice(i,1),i--);return $.unique(e).toString()},prePost:function(){if($("#loadMsg").text(Label.loadingLabel),admin.article.content="",admin.editors.articleEditor.getContent){var t=admin.editors.articleEditor.getContent();"#article/article"===window.location.hash&&""!==t.replace(/\s/g,"")&&confirm(Label.editorPostLabel)&&admin.article.clear(),$("#tipMsg").text(""),$("#loadMsg").text("")}},_addDisabled:function(){$("#unSubmitArticle").attr("disabled","disabled"),$("#saveArticle").attr("disabled","disabled"),$("#submitArticle").attr("disabled","disabled")},_removeDisabled:function(){$("#unSubmitArticle").removeAttr("disabled"),$("#saveArticle").removeAttr("disabled"),$("#submitArticle").removeAttr("disabled")}},admin.register.article={obj:admin.article,init:admin.article.init,refresh:function(){admin.editors.abstractEditor.setContent(""),admin.editors.articleEditor.setContent(""),$("#loadMsg").text(""),$("#tipMsg").text(Label.uploadMsg)}};
admin.comment={open:function(e,t){this.getList(e,t),$("#"+t+"Comments").dialog("open")},getList:function(l,c){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$("#"+c+"Comments").html("");var e="article";"page"===c&&(e="page"),$.ajax({url:Label.servePath+"/console/comments/"+e+"/"+l,type:"GET",cache:!1,success:function(e,t){if($("#tipMsg").text(e.msg),e.sc){for(var a=e.comments,n="",m=0;m<a.length;m++){var s="<a target='_blank' href='"+a[m].commentURL+"'>",o=a[m].commentContent;"http://"===a[m].commentURL&&(s="<a target='_blank'>"),n+="<div class='comment-title'><span class='fn__left'>"+s+a[m].commentName+"</a>",a[m].commentOriginalCommentName&&(n+="@"+a[m].commentOriginalCommentName),n+="</span><a title='"+Label.removeLabel+"' class='fn__right fn__pointer' href=\"javascript:admin.comment.del('"+a[m].oId+"', '"+c+"', '"+l+"')\">"+Label.removeLabel+"</a><span class='fn__right'>&nbsp;&nbsp;"+$.bowknot.getDate(a[m].commentTime)+"&nbsp;</span><div class='fn__clear'></div></div><div class='vditor-reset'>"+o+"</div>"}""===n&&(n=Label.noCommentLabel),$("#"+c+"Comments").html(n),Util.parseMarkdown(),Util.parseLanguage(),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},del:function(e,a,n){if(confirm(Label.confirmRemoveLabel+Label.commentLabel+"?")){$("#loadMsg").text(Label.loadingLabel);var t="article";"page"===a&&(t="page"),$.ajax({url:Label.servePath+"/console/"+t+"/comment/"+e,type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg),e.sc&&admin.comment.getList(n,a),$("#loadMsg").text("")}})}}};
admin.articleList={tablePagination:new TablePaginate("article"),init:function(e){this.tablePagination.buildTable([{text:Label.titleLabel,index:"title",minWidth:110,style:"padding-left: 12px;font-size:14px;"},{text:Label.authorLabel,index:"author",width:150,style:"padding-left: 12px;"},{text:Label.commentLabel,index:"comments",width:80,style:"padding-left: 12px;"},{text:Label.viewLabel,width:60,index:"articleViewCount",style:"padding-left: 12px;"},{text:Label.dateLabel,index:"date",width:90,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.tablePagination.initCommentsDialog(),this.getList(e);var a=this;$("#articleListBtn").click(function(){a.getList(e)}),$("#articleListInput").keypress(function(t){13===t.keyCode&&a.getList(e)})},syncToHacpai:function(t){$.ajax({url:Label.servePath+"/console/article/push2rhy?id="+t,type:"GET",cache:!1,success:function(t,e){$("#tipMsg").text(Label.pushSuccLabel)}})},getList:function(c){var o=this;$("#loadMsg").text(Label.loadingLabel),$.ajax({url:Label.servePath+"/console/articles/status/published/"+c+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE+"?k="+$("#articleListInput").val(),type:"GET",cache:!1,success:function(t,e){if($("#tipMsg").text(t.msg),t.sc){for(var a=t.articles,i=[],l=0;l<a.length;l++){i[l]={},i[l].title='<a href="'+Label.servePath+a[l].articlePermalink+"\" target='_blank' title='"+a[l].articleTitle+"' class='no-underline'>"+a[l].articleTitle+"</a><span class='table-tag'>"+a[l].articleTags+"</span>",i[l].date=$.bowknot.getDate(a[l].articleCreateTime),i[l].comments=a[l].articleCommentCount,i[l].articleViewCount=a[l].articleViewCount,i[l].author=a[l].authorName;var n=a[l].articlePutTop?Label.cancelPutTopLabel:Label.putTopLabel;i[l].expendRow="<a href='javascript:void(0)' onclick=\"admin.article.get('"+a[l].oId+"', true)\">"+Label.updateLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.article.del('"+a[l].oId+"', 'article', '"+encodeURIComponent(a[l].articleTitle)+"')\">"+Label.removeLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.articleList.syncToHacpai('"+a[l].oId+"')\">"+Label.pushToHacpaiLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.articleList.popTop(this, '"+a[l].oId+"')\">"+n+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.comment.open('"+a[l].oId+"', 'article')\">"+Label.commentLabel+"</a>"}o.tablePagination.updateTablePagination(i,c,t.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},popTop:function(t,e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var a=$(t),i="canceltop",l=Label.putTopLabel;a.html()===Label.putTopLabel&&(i="puttop",l=Label.cancelPutTopLabel),$.ajax({url:Label.servePath+"/console/article/"+i+"/"+e,type:"PUT",cache:!1,success:function(t,e){$("#tipMsg").text(t.msg),t.sc&&a.html(l),$("#loadMsg").text("")}})}},admin.register["article-list"]={obj:admin.articleList,init:admin.articleList.init,refresh:admin.articleList.getList};
admin.draftList={tablePagination:new TablePaginate("draft"),init:function(t){this.tablePagination.buildTable([{text:Label.titleLabel,index:"title",minWidth:110,style:"padding-left: 12px;font-size:14px;"},{text:Label.authorLabel,index:"author",width:150,style:"padding-left: 12px;"},{text:Label.commentLabel,index:"comments",width:80,style:"padding-left: 12px;"},{text:Label.viewLabel,width:60,index:"articleViewCount",style:"padding-left: 12px;"},{text:Label.dateLabel,index:"date",width:90,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.tablePagination.initCommentsDialog(),this.getList(t)},getList:function(n){$("#loadMsg").text(Label.loadingLabel);var d=this;$.ajax({url:Label.servePath+"/console/articles/status/unpublished/"+n+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(t,e){if($("#tipMsg").text(t.msg),t.sc){for(var a=t.articles,i=[],l=0;l<a.length;l++)i[l]={},i[l].tags=a[l].articleTags,i[l].date=$.bowknot.getDate(a[l].articleCreateTime),i[l].comments=a[l].articleCommentCount,i[l].articleViewCount=a[l].articleViewCount,i[l].author=a[l].authorName,i[l].title="<a class='no-underline' href='"+Label.servePath+a[l].articlePermalink+"' target='_blank'>"+a[l].articleTitle+"</a><span class='table-tag'>"+a[l].articleTags+"</span>",i[l].expendRow="<a href='javascript:void(0)' onclick=\"admin.article.get('"+a[l].oId+"', false);\">"+Label.updateLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.article.del('"+a[l].oId+"', 'draft', '"+encodeURIComponent(a[l].articleTitle)+"')\">"+Label.removeLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.comment.open('"+a[l].oId+"', 'draft')\">"+Label.commentLabel+"</a>";d.tablePagination.updateTablePagination(i,n,t.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})}},admin.register["draft-list"]={obj:admin.draftList,init:admin.draftList.init,refresh:admin.draftList.getList};
admin.pageList={tablePagination:new TablePaginate("page"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},id:"",init:function(e){this.tablePagination.buildTable([{text:"",index:"pageOrder",width:60,style:"padding-left: 12px;font-size:14px;"},{style:"padding-left: 12px;",text:Label.titleLabel,index:"pageTitle",width:300},{style:"padding-left: 12px;",text:Label.permalinkLabel,index:"pagePermalink",minWidth:100},{style:"padding-left: 12px;",text:Label.openMethodLabel,index:"pageTarget",width:120}]),this.tablePagination.initPagination(),this.getList(e)},getList:function(p){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var l=this;$.ajax({url:Label.servePath+"/console/pages/"+p+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=e.pages,i=[];admin.pageList.pageInfo.currentCount=t.length,admin.pageList.pageInfo.pageCount=0===e.pagination.paginationPageCount?1:e.pagination.paginationPageCount;for(var n=0;n<t.length;n++){i[n]={},0===n?1===t.length?i[n].pageOrder="":i[n].pageOrder='<div class="table-center" style="width:14px">                                        <span onclick="admin.pageList.changeOrder('+t[n].oId+", "+n+', \'down\');"                                         class="icon-move-down"></span></div>':n===t.length-1?i[n].pageOrder='<div class="table-center" style="width:14px">                                    <span onclick="admin.pageList.changeOrder('+t[n].oId+", "+n+', \'up\');" class="icon-move-up"></span>                                    </div>':i[n].pageOrder='<div class="table-center" style="width:38px">                                    <span onclick="admin.pageList.changeOrder('+t[n].oId+", "+n+', \'up\');" class="icon-move-up"></span>                                    <span onclick="admin.pageList.changeOrder('+t[n].oId+", "+n+', \'down\');" class="icon-move-down"></span>                                    </div>';var g="";""!==t[n].pageIcon&&(g="<img class='navigation-icon' src='"+t[n].pageIcon+"'/> "),i[n].pageTitle=g+"<a class='no-underline' href='"+t[n].pagePermalink+"' target='_blank'>"+t[n].pageTitle+"</a>",i[n].pagePermalink="<a class='no-underline' href='"+t[n].pagePermalink+"' target='_blank'>"+t[n].pagePermalink+"</a>",i[n].pageTarget=t[n].pageOpenTarget,i[n].expendRow="<span><a href='"+t[n].pagePermalink+"' target='_blank'>"+Label.viewLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.pageList.get('"+t[n].oId+"')\">"+Label.updateLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.pageList.del('"+t[n].oId+"', '"+encodeURIComponent(t[n].pageTitle)+"')\">"+Label.removeLabel+"</a></span>"}l.tablePagination.updateTablePagination(i,p,e.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},get:function(t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/page/"+t,type:"GET",cache:!1,success:function(e,a){$("#tipMsg").text(e.msg),e.sc&&(admin.pageList.id=t,$("#pageTitle").val(e.page.pageTitle),$("#pagePermalink").val(e.page.pagePermalink),$("#pageTarget").val(e.page.pageOpenTarget),$("#pageIcon").val(e.page.pageIcon)),$("#loadMsg").text("")}})},del:function(e,a){confirm(Label.confirmRemoveLabel+Label.navLabel+'"'+Util.htmlDecode(a)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/page/"+e,type:"DELETE",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=admin.pageList.pageInfo.currentPage;1===admin.pageList.pageInfo.currentCount&&1!==admin.pageList.pageInfo.pageCount&&admin.pageList.pageInfo.currentPage===admin.pageList.pageInfo.pageCount&&(admin.pageList.pageInfo.pageCount--,t=admin.pageList.pageInfo.pageCount);var i=window.location.hash.split("/");t==i[i.length-1]?admin.pageList.getList(t):admin.setHashByPage(t),$("#loadMsg").text("")}else $("#loadMsg").text("")}}))},add:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=$("#pagePermalink").val().replace(/(^\s*)|(\s*$)/g,""),a={page:{pageTitle:$("#pageTitle").val(),pagePermalink:e,pageOpenTarget:$("#pageTarget").val(),pageIcon:$("#pageIcon").val()}};$.ajax({url:Label.servePath+"/console/page/",type:"POST",cache:!1,data:JSON.stringify(a),success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){admin.pageList.id="",$("#pagePermalink").val(""),$("#pageTitle").val(""),$("#pageIcon").val(""),$("#pageTarget").val("_self"),admin.pageList.pageInfo.currentCount===Label.PAGE_SIZE&&admin.pageList.pageInfo.currentPage===admin.pageList.pageInfo.pageCount&&admin.pageList.pageInfo.pageCount++;var t=window.location.hash.split("/");admin.pageList.pageInfo.pageCount==t[t.length-1]?admin.pageList.getList(admin.pageList.pageInfo.pageCount):admin.setHashByPage(admin.pageList.pageInfo.pageCount),$("#loadMsg").text("")}else $("#loadMsg").text("")}})}},update:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=$("#pagePermalink").val().replace(/(^\s*)|(\s*$)/g,""),a={page:{pageTitle:$("#pageTitle").val(),oId:this.id,pagePermalink:e,pageOpenTarget:$("#pageTarget").val(),pageIcon:$("#pageIcon").val()}};$.ajax({url:Label.servePath+"/console/page/",type:"PUT",cache:!1,data:JSON.stringify(a),success:function(e,a){$("#tipMsg").text(e.msg),e.sc&&(admin.pageList.id="",admin.pageList.getList(admin.pageList.pageInfo.currentPage),$("#pageTitle").val(""),$("#pageIcon").val(""),$("#pagePermalink").val(""),$("#pageTarget").val("_self")),$("#loadMsg").text("")}})}},validate:function(){if(""===$("#pageTitle").val().replace(/\s/g,""))$("#tipMsg").text(Label.titleEmptyLabel),$("#pageTitle").focus();else{if(""!==$("#pagePermalink").val().replace(/\s/g,""))return!0;$("#tipMsg").text(Label.linkEmptyLabel)}return!1},submit:function(){""!==this.id?this.update():this.add()},changeOrder:function(e,a,t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var i={oId:e.toString(),direction:t};$.ajax({url:Label.servePath+"/console/page/order/",type:"PUT",cache:!1,data:JSON.stringify(i),success:function(e,a){$("#tipMsg").text(e.msg),admin.pageList.getList(admin.pageList.pageInfo.currentPage),$("#loadMsg").text("")}})}},admin.register["page-list"]={obj:admin.pageList,init:admin.pageList.init,refresh:admin.pageList.getList};
admin.others={init:function(){$("#tabOthers").tabs(),$("#loadMsg").text("")},removeUnusedArchives:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/archive/unused",type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg)}})},removeUnusedTags:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/tag/unused",type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg)}})},exportSQL:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/export/sql",type:"GET",cache:!1,success:function(e,t){e.sc?$("#tipMsg").text(e.msg):window.location=Label.servePath+"/console/export/sql"}})},exportJSON:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/export/json",type:"GET",cache:!1,success:function(e,t){e.sc?$("#tipMsg").text(e.msg):window.location=Label.servePath+"/console/export/json"}})},exportHexo:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/export/hexo",type:"GET",cache:!1,success:function(e,t){e.sc?$("#tipMsg").text(e.msg):window.location=Label.servePath+"/console/export/hexo"}})},getUnusedTags:function(){$.ajax({url:Label.servePath+"/console/tag/unused",type:"GET",cache:!1,success:function(e,t){($("#tipMsg").text(e.msg),e.sc)?e.unusedTags.length:$("#loadMsg").text("")}})}},admin.register.others={obj:admin.others,init:admin.others.init,refresh:function(){admin.clearTip()}};
admin.linkList={tablePagination:new TablePaginate("link"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},id:"",init:function(i){this.tablePagination.buildTable([{text:"",index:"linkOrder",width:60},{style:"padding-left: 12px;",text:Label.linkTitleLabel,index:"linkTitle",width:230},{style:"padding-left: 12px;",text:Label.urlLabel,index:"linkAddress",minWidth:180},{style:"padding-left: 12px;",text:Label.linkDescriptionLabel,index:"linkDescription",width:360}]),this.tablePagination.initPagination(),this.getList(i),$("#updateLink").dialog({title:$("#updateLink").data("title"),width:700,height:290,modal:!0,hideFooter:!0})},getList:function(l){$("#loadMsg").text(Label.loadingLabel),0===l&&(l=1),this.pageInfo.currentPage=l;var s=this;$.ajax({url:Label.servePath+"/console/links/"+l+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(i,e){if($("#tipMsg").text(i.msg),i.sc){var n=i.links,t=[];admin.linkList.pageInfo.currentCount=n.length,admin.linkList.pageInfo.pageCount=0===i.pagination.paginationPageCount?1:i.pagination.paginationPageCount;for(var a=0;a<n.length;a++)t[a]={},0===a?1===n.length?t[a].linkOrder="":t[a].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.linkList.changeOrder('+n[a].oId+", "+a+', \'down\');" class="icon-move-down"></span>                            </div>':a===n.length-1?t[a].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.linkList.changeOrder('+n[a].oId+", "+a+', \'up\');" class="icon-move-up"></span>                            </div>':t[a].linkOrder='<div class="table-center" style="width:38px">                                <span onclick="admin.linkList.changeOrder('+n[a].oId+", "+a+', \'up\');" class="icon-move-up"></span>                                <span onclick="admin.linkList.changeOrder('+n[a].oId+", "+a+', \'down\');" class="icon-move-down"></span>                            </div>',t[a].linkTitle=n[a].linkTitle,t[a].linkAddress="<a target='_blank' class='no-underline' href='"+n[a].linkAddress+"'>"+n[a].linkAddress+"</a>",t[a].linkDescription=n[a].linkDescription,t[a].expendRow="<span><a href='"+n[a].linkAddress+"' target='_blank'>"+Label.viewLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.linkList.get('"+n[a].oId+"')\">"+Label.updateLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.linkList.del('"+n[a].oId+"', '"+encodeURIComponent(n[a].linkTitle)+"')\">"+Label.removeLabel+"</a></span>";s.tablePagination.updateTablePagination(t,l,i.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},add:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var i={link:{linkTitle:$("#linkTitle").val(),linkAddress:$("#linkAddress").val(),linkDescription:$("#linkDescription").val()}};$.ajax({url:Label.servePath+"/console/link/",type:"POST",cache:!1,data:JSON.stringify(i),success:function(i,e){if($("#tipMsg").text(i.msg),i.sc){$("#linkTitle").val(""),$("#linkAddress").val(""),$("#linkDescription").val(""),admin.linkList.pageInfo.currentCount===Label.PAGE_SIZE&&admin.linkList.pageInfo.currentPage===admin.linkList.pageInfo.pageCount&&admin.linkList.pageInfo.pageCount++;var n=window.location.hash.split("/");admin.linkList.pageInfo.pageCount!==parseInt(n[n.length-1])&&admin.setHashByPage(admin.linkList.pageInfo.pageCount),admin.linkList.getList(admin.linkList.pageInfo.pageCount),$("#loadMsg").text("")}else $("#loadMsg").text("")}})}},get:function(n){$("#loadMsg").text(Label.loadingLabel),$("#updateLink").dialog("open"),$.ajax({url:Label.servePath+"/console/link/"+n,type:"GET",cache:!1,success:function(i,e){$("#tipMsg").text(i.msg),i.sc&&(admin.linkList.id=n,$("#linkTitleUpdate").val(i.link.linkTitle),$("#linkAddressUpdate").val(i.link.linkAddress),$("#linkDescriptionUpdate").val(i.link.linkDescription)),$("#loadMsg").text("")}})},update:function(){if(this.validate("Update")){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var i={link:{linkTitle:$("#linkTitleUpdate").val(),oId:this.id,linkAddress:$("#linkAddressUpdate").val(),linkDescription:$("#linkDescriptionUpdate").val()}};$.ajax({url:Label.servePath+"/console/link/",type:"PUT",cache:!1,data:JSON.stringify(i),success:function(i,e){$("#updateLink").dialog("close"),$("#tipMsg").text(i.msg),i.sc&&admin.linkList.getList(admin.linkList.pageInfo.currentPage),$("#loadMsg").text("")}})}},del:function(i,e){confirm(Label.confirmRemoveLabel+Label.permalinkLabel+'"'+Util.htmlDecode(e)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/link/"+i,type:"DELETE",cache:!1,success:function(i,e){if($("#tipMsg").text(i.msg),i.sc){var n=admin.linkList.pageInfo.currentPage;1===admin.linkList.pageInfo.currentCount&&1!==admin.linkList.pageInfo.pageCount&&admin.linkList.pageInfo.currentPage===admin.linkList.pageInfo.pageCount&&(admin.linkList.pageInfo.pageCount--,n=admin.linkList.pageInfo.pageCount);var t=window.location.hash.split("/");n!==parseInt(t[t.length-1])&&admin.setHashByPage(n),admin.linkList.getList(n),$("#loadMsg").text("")}else $("#loadMsg").text("")}}))},validate:function(i){if(i||(i=""),""===$("#linkTitle"+i).val().replace(/\s/g,""))$("#tipMsg").text(Label.titleEmptyLabel),$("#linkTitle"+i).focus().val("");else if(""===$("#linkAddress"+i).val().replace(/\s/g,""))$("#tipMsg").text(Label.addressEmptyLabel),$("#linkAddress"+i).focus().val("");else{if(/^\w+:\/\//.test($("#linkAddress"+i).val()))return!0;$("#tipMsg").text(Label.addressInvalidLabel),$("#linkAddress"+i).focus().val("")}return!1},changeOrder:function(i,e,n){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var t={oId:i.toString(),direction:n};$.ajax({url:Label.servePath+"/console/link/order/",type:"PUT",cache:!1,data:JSON.stringify(t),success:function(i,e){$("#tipMsg").text(i.msg),admin.linkList.getList(admin.linkList.pageInfo.currentPage),$("#loadMsg").text("")}})}},admin.register["link-list"]={obj:admin.linkList,init:admin.linkList.init,refresh:admin.linkList.getList};
admin.preference={locale:"",init:function(){$("#tabPreference").tabs(),$.ajax({url:Label.servePath+"/console/preference/",type:"GET",cache:!1,success:function(result,textStatus){if($("#tipMsg").text(result.msg),result.sc){var preference=result.preference;$("#metaKeywords").val(preference.metaKeywords),$("#metaDescription").val(preference.metaDescription),$("#blogTitle").val(preference.blogTitle),$("#blogSubtitle").val(preference.blogSubtitle),$("#mostCommentArticleDisplayCount").val(preference.mostCommentArticleDisplayCount),$("#mostViewArticleDisplayCount").val(preference.mostViewArticleDisplayCount),$("#recentCommentDisplayCount").val(preference.recentCommentDisplayCount),$("#mostUsedTagDisplayCount").val(preference.mostUsedTagDisplayCount),$("#articleListDisplayCount").val(preference.articleListDisplayCount),$("#articleListPaginationWindowSize").val(preference.articleListPaginationWindowSize),$("#localeString").val(preference.localeString),$("#timeZoneId").val(preference.timeZoneId),$("#noticeBoard").val(preference.noticeBoard),$("#footerContent").val(preference.footerContent),$("#htmlHead").val(preference.htmlHead),$("#externalRelevantArticlesDisplayCount").val(preference.externalRelevantArticlesDisplayCount),$("#relevantArticlesDisplayCount").val(preference.relevantArticlesDisplayCount),$("#randomArticlesDisplayCount").val(preference.randomArticlesDisplayCount),$("#customVars").val(preference.customVars),"true"===preference.enableArticleUpdateHint?$("#enableArticleUpdateHint").attr("checked","checked"):$("#enableArticleUpdateHint").removeAttr("checked"),"true"===preference.allowVisitDraftViaPermalink?$("#allowVisitDraftViaPermalink").attr("checked","checked"):$("allowVisitDraftViaPermalink").removeAttr("checked"),"true"===preference.commentable?$("#commentable").attr("checked","checked"):$("commentable").removeAttr("checked"),"true"===preference.syncGitHub?$("#syncGitHub").attr("checked","checked"):$("syncGitHub").removeAttr("checked"),"true"===preference.pullGitHub?$("#pullGitHub").attr("checked","checked"):$("pullGitHub").removeAttr("checked"),admin.preference.locale=preference.localeString;for(var signs=eval("("+preference.signs+")"),j=1;j<signs.length;j++)$("#preferenceSign"+j).val(signs[j].signHTML);$("#articleListDisplay").val(preference.articleListStyle),$("#hljsTheme").val(preference.hljsTheme),$("#feedOutputMode").val(preference.feedOutputMode),$("#feedOutputCnt").val(preference.feedOutputCnt),$("#faviconURL").val(preference.faviconURL),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},validate:function(){return/^\d+$/.test($("#mostUsedTagDisplayCount").val())?/^\d+$/.test($("#recentCommentDisplayCount").val())?/^\d+$/.test($("#mostCommentArticleDisplayCount").val())?/^\d+$/.test($("#mostViewArticleDisplayCount").val())?/^\d+$/.test($("#articleListDisplayCount").val())?/^\d+$/.test($("#articleListPaginationWindowSize").val())?/^\d+$/.test($("#randomArticlesDisplayCount").val())?/^\d+$/.test($("#relevantArticlesDisplayCount").val())?!!/^\d+$/.test($("#externalRelevantArticlesDisplayCount").val())||($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.externalRelevantArticlesDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#externalRelevantArticlesDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.relevantArticlesDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#relevantArticlesDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.randomArticlesDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#randomArticlesDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.windowSizeLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#articleListPaginationWindowSize").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.pageSizeLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#articleListDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexMostViewArticleDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#mostViewArticleDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexMostCommentArticleDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#mostCommentArticleDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexRecentCommentDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#recentCommentDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexTagDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#mostUsedTagDisplayCount").focus(),!1)},update:function(){if(admin.preference.validate()){$("#tipMsg").text(""),$("#loadMsg").text(Label.loadingLabel);var e=[{oId:0,signHTML:""},{oId:1,signHTML:$("#preferenceSign1").val()},{oId:2,signHTML:$("#preferenceSign2").val()},{oId:3,signHTML:$("#preferenceSign3").val()}],t={preference:{metaKeywords:$("#metaKeywords").val(),metaDescription:$("#metaDescription").val(),blogTitle:$("#blogTitle").val(),blogSubtitle:$("#blogSubtitle").val(),mostCommentArticleDisplayCount:$("#mostCommentArticleDisplayCount").val(),mostViewArticleDisplayCount:$("#mostViewArticleDisplayCount").val(),recentCommentDisplayCount:$("#recentCommentDisplayCount").val(),mostUsedTagDisplayCount:$("#mostUsedTagDisplayCount").val(),articleListDisplayCount:$("#articleListDisplayCount").val(),articleListPaginationWindowSize:$("#articleListPaginationWindowSize").val(),localeString:$("#localeString").val(),timeZoneId:$("#timeZoneId").val(),noticeBoard:$("#noticeBoard").val(),footerContent:$("#footerContent").val(),htmlHead:$("#htmlHead").val(),externalRelevantArticlesDisplayCount:$("#externalRelevantArticlesDisplayCount").val(),relevantArticlesDisplayCount:$("#relevantArticlesDisplayCount").val(),randomArticlesDisplayCount:$("#randomArticlesDisplayCount").val(),enableArticleUpdateHint:$("#enableArticleUpdateHint").prop("checked"),signs:e,allowVisitDraftViaPermalink:$("#allowVisitDraftViaPermalink").prop("checked"),articleListStyle:$("#articleListDisplay").val(),hljsTheme:$("#hljsTheme").val(),feedOutputMode:$("#feedOutputMode").val(),feedOutputCnt:$("#feedOutputCnt").val(),faviconURL:$("#faviconURL").val(),syncGitHub:$("#syncGitHub").prop("checked"),pullGitHub:$("#pullGitHub").prop("checked"),commentable:$("#commentable").prop("checked"),customVars:$("#customVars").val()}};$.ajax({url:Label.servePath+"/console/preference/",type:"PUT",cache:!1,data:JSON.stringify(t),success:function(e,t){$("#tipMsg").text(e.msg),e.sc&&$("#localeString").val()!==admin.preference.locale&&window.location.reload(),$("#loadMsg").text("")}})}}},admin.register.preference={obj:admin.preference,init:admin.preference.init,refresh:function(){admin.clearTip()}};
admin.themeList={skinDirName:"",mobileSkinDirName:"",init:function(){$.ajax({url:Label.servePath+"/console/skin",type:"GET",cache:!1,success:function(i,e){if($("#tipMsg").text(i.msg),i.sc){admin.themeList.skinDirName=i.skin.skinDirName,admin.themeList.mobileSkinDirName=i.skin.mobileSkinDirName;for(var a=JSON.parse(i.skin.skins),s="",t=0;t<a.length;t++){var n="";a[t].skinDirName===i.skin.skinDirName&&(n=" selected"),s+='<div class="fn__left skinItem'+n+'"><div class="ft__center">'+a[t].skinDirName+'</div><img class="skinPreview" src="'+Label.staticServePath+"/skins/"+a[t].skinDirName+'/preview.png"/><div>',a[t].skinDirName!==i.skin.skinDirName&&(s+='<button class="small update fn__left" data-name="'+a[t].skinDirName+'">'+Label.enableLabel+"</button>"),a[t].skinDirName!==i.skin.mobileSkinDirName&&(s+='<button class="small mobile fn__left" data-name="'+a[t].skinDirName+'">'+Label.setMobileLabel+"</button>"),s+='<button class="small fn__right" onclick="window.open(\''+Label.servePath+"?skin="+a[t].skinDirName+"')\">"+Label.previewLabel+"</button></div></div>"}$("#skinMain").html(s+"<div class='fn__clear'></div>"),$(".skinItem .update").click(function(){admin.themeList.update($(this).data("name"),"pc")}),$(".skinItem .mobile").click(function(){admin.themeList.update($(this).data("name"),"mobile")}),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},update:function(i,e){$("#tipMsg").text(""),$("#loadMsg").text(Label.loadingLabel);var a={skin:{skinDirName:admin.themeList.skinDirName,mobileSkinDirName:admin.themeList.mobileSkinDirName}};"pc"===e?a.skin.skinDirName=i:a.skin.mobileSkinDirName=i,$.ajax({url:Label.servePath+"/console/skin",type:"PUT",cache:!1,data:JSON.stringify(a),success:function(i,e){$("#tipMsg").text(i.msg),i.sc&&admin.themeList.init(),$("#loadMsg").text("")}})}},admin.register["theme-list"]={obj:admin.themeList,init:admin.themeList.init,refresh:function(){$("#loadMsg").text("")}};
admin.pluginList={tablePagination:new TablePaginate("plugin"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},init:function(t){this.tablePagination.buildTable([{style:"padding-left: 12px;",text:Label.pluginNameLabel,index:"name",width:230},{style:"padding-left: 12px;",text:Label.statusLabel,index:"status",minWidth:80},{style:"padding-left: 12px;",text:Label.authorLabel,index:"author",width:200},{style:"padding-left: 12px;",text:Label.versionLabel,index:"version",width:120}]),this.tablePagination.initPagination(),$("#pluginSetting").dialog({width:700,height:180,modal:!0,hideFooter:!0}),this.getList(t)},getList:function(n){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var l=this;$.ajax({url:Label.servePath+"/console/plugins/"+n+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(t,e){if($("#tipMsg").text(t.msg),t.sc){admin.pluginList.pageInfo.currentPage=n;for(var a=t.plugins,i=0;i<a.length;i++)a[i].expendRow="<a href='javascript:void(0)' onclick=\"admin.pluginList.changeStatus('"+a[i].oId+"', '"+a[i].status+"')\">","ENABLED"===a[i].status?(a[i].status=Label.enabledLabel,a[i].expendRow+=Label.disableLabel):(a[i].status=Label.disabledLabel,a[i].expendRow+=Label.enableLabel),a[i].expendRow+="</a>  ","{}"!=a[i].setting&&(a[i].expendRow+="<a href='javascript:void(0)' onclick=\"admin.pluginList.toSetting('"+a[i].oId+"')\"> "+Label.settingLabel+" </a>  ");l.tablePagination.updateTablePagination(t.plugins,n,t.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},toSetting:function(t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e={oId:t};$.ajax({url:Label.servePath+"/console/plugin/toSetting",type:"POST",cache:!1,data:JSON.stringify(e),success:function(t,e){$("#tipMsg").text(t.msg),$("#pluginSetting").html(t),$("#pluginSetting").dialog("open"),$("#loadMsg").text("")}})},changeStatus:function(t,e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var a={oId:t,status:e="ENABLED"===e?"DISABLED":"ENABLED"};$.ajax({url:Label.servePath+"/console/plugin/status/",type:"PUT",cache:!1,data:JSON.stringify(a),success:function(t,e){$("#tipMsg").text(t.msg),t.sc?($("#loadMsg").text(""),window.location.reload()):$("#loadMsg").text("")}})}},admin.register["plugin-list"]={obj:admin.pluginList,init:admin.pluginList.init,refresh:function(){$("#loadMsg").text("")}};
admin.userList={tablePagination:new TablePaginate("user"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},userInfo:{oId:"",userRole:""},init:function(e){this.tablePagination.buildTable([{style:"padding-left: 12px;",text:Label.userNameLabel,index:"userName",width:230},{style:"padding-left: 12px;",text:Label.roleLabel,index:"isAdmin",width:120}]),this.tablePagination.initPagination(),this.getList(e),$("#userUpdate").dialog({width:700,height:450,modal:!0,hideFooter:!0})},getList:function(n){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),this.pageInfo.currentPage=n;var r=this;$.ajax({url:Label.servePath+"/console/users/"+n+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=e.users,s=[];if(admin.userList.pageInfo.currentCount=t.length,admin.userList.pageInfo.pageCount=e.pagination.paginationPageCount,t.length<1)return $("#tipMsg").text("No user  "+Label.reportIssueLabel),void $("#loadMsg").text("");$("#tipMsg").text(Label.uploadMsg);for(var i=0;i<t.length;i++)s[i]={},s[i].userName=t[i].userName,"adminRole"===t[i].userRole?(s[i].isAdmin="&nbsp;"+Label.administratorLabel,s[i].expendRow="<a href='javascript:void(0)' onclick=\"admin.userList.get('"+t[i].oId+"', '"+t[i].userRole+"')\">"+Label.updateLabel+"</a>"):(s[i].expendRow="<a href='javascript:void(0)' onclick=\"admin.userList.get('"+t[i].oId+"', '"+t[i].userRole+"')\">"+Label.updateLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.userList.del('"+t[i].oId+"', '"+encodeURIComponent(t[i].userName)+"')\">"+Label.removeLabel+"</a> <a href='javascript:void(0)' onclick=\"admin.userList.changeRole('"+t[i].oId+"')\">"+Label.changeRoleLabel+"</a>","defaultRole"===t[i].userRole?s[i].isAdmin=Label.commonUserLabel:s[i].isAdmin=Label.visitorUserLabel),r.tablePagination.updateTablePagination(s,n,e.pagination);$("#loadMsg").text("")}else $("#loadMsg").text("")}})},get:function(t,s){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$("#userUpdate").dialog("open"),$.ajax({url:Label.servePath+"/console/user/"+t,type:"GET",cache:!1,success:function(e,a){$("#tipMsg").text(e.msg),e.sc&&($("#userURLUpdate").val(e.user.userURL),$("#userAvatarUpdate").val(e.user.userAvatar),$("#userB3KeyUpdate").val(e.user.userB3Key),$("#userNameUpdate").val(e.user.userName).data("userInfo",{oId:t,userRole:s})),$("#loadMsg").text("")}})},update:function(){if(this.validate("Update")){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=$("#userNameUpdate").data("userInfo"),a={userName:$("#userNameUpdate").val(),oId:e.oId,userURL:$("#userURLUpdate").val(),userRole:e.userRole,userAvatar:$("#userAvatarUpdate").val(),userB3Key:$("#userB3KeyUpdate").val()};$.ajax({url:Label.servePath+"/console/user/",type:"PUT",cache:!1,data:JSON.stringify(a),success:function(e,a){$("#userUpdate").dialog("close"),$("#tipMsg").text(e.msg),e.sc&&admin.userList.getList(admin.userList.pageInfo.currentPage),$("#loadMsg").text("")}})}},del:function(e,a){confirm(Label.confirmRemoveLabel+Label.userLabel+'"'+Util.htmlDecode(a)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/user/"+e,type:"DELETE",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=admin.userList.pageInfo.currentPage;1===admin.userList.pageInfo.currentCount&&1!==admin.userList.pageInfo.pageCount&&admin.userList.pageInfo.currentPage===admin.userList.pageInfo.pageCount&&(admin.userList.pageInfo.pageCount--,t=admin.userList.pageInfo.pageCount);var s=window.location.hash.split("/");t!==parseInt(s[s.length-1])&&admin.setHashByPage(t),admin.userList.getList(t),$("#loadMsg").text("")}else $("#loadMsg").text("")}}))},changeRole:function(e){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/changeRole/"+e,type:"GET",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=admin.userList.pageInfo.currentPage;1===admin.userList.pageInfo.currentCount&&1!==admin.userList.pageInfo.pageCount&&admin.userList.pageInfo.currentPage===admin.userList.pageInfo.pageCount&&(admin.userList.pageInfo.pageCount--,t=admin.userList.pageInfo.pageCount);var s=window.location.hash.split("/");t!==parseInt(s[s.length-1])&&admin.setHashByPage(t),admin.userList.getList(t),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},validate:function(e){e||(e="");var a=$("#userName"+e).val().replace(/(^\s*)|(\s*$)/g,"");return!(a.length<2||20<a.length)||($("#tipMsg").text(Label.nameTooLongLabel),$("#userName"+e).focus(),!1)}},admin.register["user-list"]={obj:admin.userList,init:admin.userList.init,refresh:admin.userList.getList};
admin.categoryList={tablePagination:new TablePaginate("category"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},init:function(e){this.tablePagination.buildTable([{text:"",index:"linkOrder",width:60},{style:"padding-left: 12px;",text:Label.titleLabel,index:"categoryTitle",width:230},{style:"padding-left: 12px;",text:"URI",index:"categoryURI",width:230},{style:"padding-left: 12px;",text:Label.descriptionLabel,index:"categoryDesc",minWidth:180}]),this.tablePagination.initPagination(),this.getList(e),$.ajax({url:Label.servePath+"/console/tags",type:"GET",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){if(!(e.tags.length<=0)){for(var t=[],o=0;o<e.tags.length;o++)t.push(e.tags[o].tagTitle);$("#categoryTags").completed({height:160,buttonText:Label.selectLabel,data:t}),$("#loadMsg").text("")}}else $("#loadMsg").text("")}})},getList:function(n){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),this.pageInfo.currentPage=n;var g=this;$.ajax({url:Label.servePath+"/console/categories/"+n+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=e.categories,o=[];admin.categoryList.pageInfo.currentCount=t.length,admin.categoryList.pageInfo.pageCount=0===e.pagination.paginationPageCount?1:e.pagination.paginationPageCount;for(var i=0;i<t.length;i++)o[i]={},0===i?1===t.length?o[i].linkOrder="":o[i].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.categoryList.changeOrder('+t[i].oId+", "+i+', \'down\');" class="icon-move-down"></span>                            </div>':i===t.length-1?o[i].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.categoryList.changeOrder('+t[i].oId+", "+i+', \'up\');" class="icon-move-up"></span>                            </div>':o[i].linkOrder='<div class="table-center" style="width:38px">                                <span onclick="admin.categoryList.changeOrder('+t[i].oId+", "+i+', \'up\');" class="icon-move-up"></span>                                <span onclick="admin.categoryList.changeOrder('+t[i].oId+", "+i+', \'down\');" class="icon-move-down"></span>                            </div>',o[i].categoryTitle=t[i].categoryTitle,o[i].categoryURI=t[i].categoryURI,o[i].categoryDesc=t[i].categoryDescription,o[i].expendRow="<a href='javascript:void(0)' onclick=\"admin.categoryList.get('"+t[i].oId+"')\">"+Label.updateLabel+"</a>                            <a href='javascript:void(0)' onclick=\"admin.categoryList.del('"+t[i].oId+"', '"+encodeURIComponent(t[i].categoryTitle)+"')\">"+Label.removeLabel+"</a> ";g.tablePagination.updateTablePagination(o,n,e.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},add:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e={categoryTitle:$("#categoryName").val(),categoryTags:$("#categoryTags").val(),categoryURI:$("#categoryURI").val(),categoryDescription:$("#categoryDesc").val()},o=$("#categoryName").data("oId"),a="POST";o&&(e.oId=o,a="PUT"),$.ajax({url:Label.servePath+"/console/category/",type:a,cache:!1,data:JSON.stringify(e),success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){if(!o){admin.categoryList.pageInfo.currentCount===Label.PAGE_SIZE&&admin.categoryList.pageInfo.currentPage===admin.categoryList.pageInfo.pageCount&&admin.categoryList.pageInfo.pageCount++;var t=window.location.hash.split("/");admin.categoryList.pageInfo.pageCount!==parseInt(t[t.length-1])&&admin.setHashByPage(admin.categoryList.pageInfo.pageCount)}$("#categoryName").val("").data("oId",""),$("#categoryTags").val(""),$("#categoryURI").val(""),$("#categoryDesc").val(""),admin.categoryList.getList(admin.categoryList.pageInfo.pageCount),$("#loadMsg").text("")}else $("#loadMsg").text("")}})}},get:function(t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/category/"+t,type:"GET",cache:!1,success:function(e,a){$("#tipMsg").text(e.msg),e.sc&&($("#categoryName").val(e.categoryTitle).data("oId",t),$("#categoryURI").val(e.categoryURI),$("#categoryDesc").val(e.categoryDescription),$("#categoryTags").val(e.categoryTags)),$("#loadMsg").text("")}})},del:function(e,a){confirm(Label.confirmRemoveLabel+Label.categoryLabel+'"'+Util.htmlDecode(a)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/category/"+e,type:"DELETE",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=admin.categoryList.pageInfo.currentPage;1===admin.categoryList.pageInfo.currentCount&&1!==admin.categoryList.pageInfo.pageCount&&admin.categoryList.pageInfo.currentPage===admin.categoryList.pageInfo.pageCount&&(admin.categoryList.pageInfo.pageCount--,t=admin.categoryList.pageInfo.pageCount);var o=window.location.hash.split("/");t!==parseInt(o[o.length-1])&&admin.setHashByPage(t),admin.categoryList.getList(t),$("#loadMsg").text("")}else $("#loadMsg").text("")}}))},validate:function(e){e||(e="");var a=$("#categoryName"+e).val().replace(/(^\s*)|(\s*$)/g,"");if(a.length<2||32<a.length)$("#tipMsg").text(Label.categoryTooLongLabel),$("#categoryName"+e).focus();else{if(""!==$.trim($("#categoryTags"+e).val()))return!0;$("#tipMsg").text(Label.tagsEmptyLabel),$("#categoryTags"+e).focus()}return!1},changeOrder:function(e,a,t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var o={oId:e.toString(),direction:t};$.ajax({url:Label.servePath+"/console/category/order/",type:"PUT",cache:!1,data:JSON.stringify(o),success:function(e,a){$("#tipMsg").text(e.msg),admin.categoryList.getList(admin.categoryList.pageInfo.currentPage),$("#loadMsg").text("")}})}},admin.register["category-list"]={obj:admin.categoryList,init:admin.categoryList.init,refresh:admin.categoryList.getList};
admin.commentList={tablePagination:new TablePaginate("comment"),pageInfo:{currentPage:1},init:function(e){this.tablePagination.buildTable([{text:Label.commentContentLabel,index:"content",minWidth:174,style:"padding-left: 12px;"},{text:Label.authorLabel,index:"title",style:"padding-left: 12px;",width:154},{text:Label.dateLabel,index:"date",width:60,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.getList(e)},getList:function(l){var o=this;$("#loadMsg").text(Label.loadingLabel),$.ajax({url:Label.servePath+"/console/comments/"+l+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(e,t){if($("#tipMsg").text(e.msg),e.sc){o.pageInfo.currentPage=l;for(var a=e.comments,n=[],i=0;i<a.length;i++){n[i]={},n[i].content='<div class="vditor-reset">'+a[i].commentContent+"</div><span class='table-tag'> on &nbsp;&nbsp;</span><a href='"+Label.servePath+a[i].commentSharpURL+"' target='_blank'>"+a[i].commentTitle+"</a>",n[i].expendRow="<a href='javascript:void(0)' onclick=\"admin.commentList.del('"+a[i].oId+"', 'Article')\">"+Label.removeLabel+"</a>",n[i].title="<img class='small-head' src='"+a[i].commentThumbnailURL+"'/>","http://"===a[i].commentURL?n[i].title+=a[i].commentName:n[i].title+="<a href='"+a[i].commentURL+"' target='_blank' class='no-underline'>"+a[i].commentName+"</a>",n[i].title+="<br/>",n[i].date=$.bowknot.getDate(a[i].commentTime)}o.tablePagination.updateTablePagination(n,l,e.pagination),Util.parseMarkdown(),Util.parseLanguage(),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},del:function(e,t){confirm(Label.confirmRemoveLabel+Label.commentLabel+"?")&&($("#loadMsg").text(Label.loadingLabel),$.ajax({url:Label.servePath+"/console/"+t.toLowerCase()+"/comment/"+e,type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg),e.sc&&admin.commentList.getList(admin.commentList.pageInfo.currentPage),$("#loadMsg").text("")}}))}},admin.register["comment-list"]={obj:admin.commentList,init:admin.commentList.init,refresh:admin.commentList.getList};
var plugins={};admin.plugin={plugins:[],add:function(t){t.isInit=!1,t.hash=t.path.replace("/","#")+"/"+t.id,this.plugins.push(t);var a=this._analysePath(t.path);t.index&&a.length<2&&this._addNew(t,a)},setCurByHash:function(t){for(var a=this.plugins,e=0;e<a.length;e++){var n=a[e],i=this._analysePath(n.path),s=!1;n.index&&-1<window.location.hash.indexOf(n.hash)?s=!0:(n.path.replace("/","#")===window.location.hash||"#main"===window.location.hash&&-1<n.path.indexOf("/main/panel"))&&(s=!0),s&&(n.isInit?plugins[n.id].refresh&&plugins[n.id].refresh(t.page):(n.index?2===i.length&&this._addNew(n,i):this._addToExist(n,i),plugins[n.id].init(t.page),n.isInit=!0))}},_analysePath:function(t){var a=t.split("/");return a.splice(0,1),a},_addNew:function(t,a){if(2===a.length)return t.target=$("#tabPreference li").get(t.index-1),void $("#tabPreference").tabs("add",t);""===a[0]?t.target=$("#tabs>ul>li").get(t.index-1):"article"===a[0]?t.target=$("#tabArticleMgt>li").get(t.index-1):"tools"===a[0]&&(admin.tools.push("#"+t.id),t.target=$("#tabTools>li").get(t.index-1)),t.target||alert("data.index is error!"),$("#tabs").tabs("add",t)},_addToExist:function(t,a){switch(a[0]){case"main":$("#mainPanel"+a[1].charAt(5)).append(t.content);break;case"tools":case"article":2===a.length?$("#tabsPanel_"+a[1]).append(t.content):$("#tabPreferencePanel_"+a[2]).append(t.content);break;case"comment-list":$("#tabsPanel_comment-list").append(t.content)}}};
admin.main={},admin.register.main={obj:admin.main,init:function(){admin.clearTip()},refresh:function(){admin.clearTip()}};
admin.about={init:function(){$.ajax({url:"https://rhythm.b3log.org/version/solo/latest/"+Label.version,type:"GET",cache:!1,dataType:"jsonp",success:function(a,e){var t=a.soloVersion;t===Label.version?$("#aboutLatest").text(Label.upToDateLabel):$("#aboutLatest").html(Label.outOfDateLabel+"<a href='"+a.soloDownload+"'>"+t+"</a>")},complete:function(a,e){admin.clearTip()}}),$.ajax({url:"https://hacpai.com/apis/sponsors",type:"GET",dataType:"jsonp",jsonp:"callback",success:function(a,e){for(var t=a.data.payments,n="",s=0;s<t.length;s++){var o="<b>\u533f\u540d\u597d\u5fc3\u4eba</b>";t[s].paymentUserName&&(o='<a href="https://hacpai.com/member/'+t[s].paymentUserName+'"><b>'+t[s].paymentUserName+"</b></a>"),n+='<li><div class="fn__flex">'+o+' <span class="ft__green fn__flex-1">&nbsp;'+t[s].paymentAmount+'RMB</span><time class="ft__fade">&nbsp;&nbsp;'+t[s].paymentTimeStr+"</time></div><div>"+t[s].paymentMemo+"</div></li>"}$("#adminAboutSponsors").html(n)},complete:function(a,e){admin.clearTip()}})}},admin.register.about={obj:admin.about,init:admin.about.init,refresh:function(){admin.clearTip()}};